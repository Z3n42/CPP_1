groups:
- name: monitoring_alerts
  rules:
  - alert: HighMemoryUsage
    expr: process_virtual_memory_bytes > 500000000
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "High memory usage detected on {{ $labels.instance }}"
      description: "Virtual memory usage is above 500MB (current value: {{ $value }} bytes)"

  - alert: HighRequestLatency
    expr: histogram_quantile(0.95, rate(django_http_requests_latency_seconds_bucket[5m])) > 0.5
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High latency in HTTP requests detected"
      description: "95% of requests have a latency higher than 500ms"

  - alert: DatabaseConnectionErrors
    expr: increase(django_db_new_connection_errors_total[5m]) > 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "Database connection errors detected"
      description: "New database connection errors have occurred in the last 5 minutes"

  - alert: HighFileDescriptorUsage
    expr: process_open_fds / process_max_fds > 0.8
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "High file descriptor usage detected"
      description: "More than 80% of available file descriptors are in use"

  - alert: HighErrorRate
    expr: increase(django_http_responses_total_by_status_total{status="500"}[5m]) > 5
    for: 1m
    labels:
      severity: critical
      status: "500"
    annotations:
      summary: "High error rate detected in Django application"
      description: "More than 5 HTTP 500 responses in the last minute"